
@{
    ViewBag.Title = "Index";
}

<h2>Index</h2>

@Styles.Render("~/Content/css-m")


<section id="search" class="row">
    <div class="col-8">
        <form class="form-inline">
            <input id="datepicker1" placeholder="Name..." class="form-control" />
            <span class="mx-3">~</span>
            <input id="datepicker2" placeholder="Place O" class="form-control" />
        </form>
    </div>
    <div class="col-4">
        <button id="btnSearch" type="button" class="btn btn-primary float-right">Search</button>
    </div>

</section>
<hr />

<div id="QuestionTable">


</div>

@* 这是 modal dialog *@
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title" id="exampleModalLabel">Add Topic</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group has-search">
                    <span class="fa fa-search form-control-feedback"></span>
                    <input type="text" class="form-control" placeholder="Search">
                </div>
                <div id="tree"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Send message</button>
            </div>
        </div>
    </div>
</div>


@section scripts{
    <script type="text/javascript">

        $(function () {

            var $datepicker1 = $('#datepicker1').datepicker({
                uiLibrary: 'bootstrap4',
                locale: 'zh-cn',
                format: 'yyyy-mm-dd'
            });

            var $datepicker2 = $('#datepicker2').datepicker({
                uiLibrary: 'bootstrap4',
                locale: 'zh-cn',
                format: 'yyyy-mm-dd'
            });

            //Search button
            $("#btnSearch").click(function () {

                // set  loading state
                var that_btn = $(this);
                that_btn.prop("disabled", true);
                    // add spinner to button
                that_btn.html(
                    `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Loading...`
                );

                let startDate = $datepicker1.value() + " +08:00";
                let endDate = $datepicker2.value() + " +08:00";

                console.log(startDate);

                $.ajax({
                    url: `/Question/GetAllQuestionsAsync?start=${startDate}&end=${endDate}&subscriptions=1834`,
                    contentType: 'application/html; charset=utf-8',
                    type: 'GET',
                    dataType: 'html'
                })
                    .done(function (result) {
                        $('#QuestionTable').html(result);
                    })
                    .fail(function (xhr, status) {
                        alert(status);
                    })
                    .always(function () {
                        // reset the button
                        that_btn.prop("disabled", false);
                        that_btn.html('Search');
                    });
            });

            

            //get fake topics
            $.ajax({
                url: "/Topic/GetfakeTopics",
                method: "Get",
                headers: {
                    'content-type': 'application/json;odata=verbose',
                    'accept': 'application/json;odata=verbose'
                },
                success: function (data) {
                    window.data = data;
                    console.log(data);
                },
                error: function (error) {
                    alert('fail');
                }
            });


            // treeview 初始化          

            window.options = {
                searchBox: $('.has-search>input[placeholder="Search"]'),
            };

            //end!
        });
    </script>
}


